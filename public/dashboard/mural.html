<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="dash.css">
    <link rel="stylesheet" href="mural.css" />
    <title>Comentários</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .comentario-usuario {
        background-color: black;
        color: white;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <video autoplay loop muted playsinline class="background-video">
      <source src="img/fundoDash.mp4" type="video/mp4" />
    </video>
    <script>
      const video = document.querySelector('.background-video');
      video.playbackRate = 0.15; 
    </script>
    
    <div class="painel">
      <header>
        <div class="logo-box">
          <img src="img/logo.jpg" alt="Logo Game Awards" class="logo" />
        </div>
        
        <div class="header-buttons">
          <a href="Musica.html">Músicas</a>
          <a href="cards.html">Votos</a>
          <a href="mural.html">Comentários</a>
          <a href="public/login.html">Sair</a>
          <br>
          <h1>Acordes da Alma</h1>

          <div class="hello">
            <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
          </div>
        </div>
      </header>
      <div class="content">
        <h1>Publicar um comentário</h1>
        <div class="comentario-container">
          <form id="form_comentario" onsubmit="return publicarComentario()">
            <textarea
              id="textarea_comentario"
              rows="5"
              placeholder="Escreva seu comentário (mínimo de 5 palavras)..."
            ></textarea>
            <select id="select_emocao">
              <option value="">Selecione uma emoção</option>
              <option value="Feliz">Alegria</option>
              <option value="Triste">Tristeza</option>
              <option value="Bravo">Êxtase</option>
              <option value="Animado">Amor</option>
              <option value="Surpreso">Pensativo</option>
            </select>
            <button type="submit" class="btn-enviar">Enviar</button>
          </form>
        </div>
        <h2>Comentários</h2>
        <div id="comentarios_container" class="comentarios-container"></div>
      </div>
  
    </div>

 
    <script>
      // Função para carregar o nome do usuário na página
      document.getElementById("b_usuario").textContent = sessionStorage.getItem("NOME_USUARIO") || "Usuário Anônimo";

      // Função para publicar comentário
      function publicarComentario() {
        const comentario = document.getElementById("textarea_comentario").value.trim();
        const emocao = document.getElementById("select_emocao").value;

        if (comentario.split(" ").length < 5) {
          alert("Seu comentário deve ter pelo menos 5 palavras!");
          return false;
        }

        if (!emocao) {
          alert("Selecione uma emoção!");
          return false;
        }

        const novoComentario = {
          texto: comentario,
          emocao: emocao,
          autor: sessionStorage.getItem("NOME_USUARIO") || "Usuário Anônimo",
          data: new Date().toLocaleString(),
        };

        // Salvar no localStorage
        let comentariosSalvos = JSON.parse(localStorage.getItem('comentarios')) || [];
        comentariosSalvos.push(novoComentario);
        localStorage.setItem('comentarios', JSON.stringify(comentariosSalvos));

        // Atualizar a visualização dos comentários
        renderizarComentarios();

        // Limpar o formulário
        document.getElementById("form_comentario").reset();
        return false;
      }

      // Função para renderizar os comentários
      function renderizarComentarios() {
        const divComentarios = document.getElementById("comentarios_container");
        divComentarios.innerHTML = '';

        let comentariosSalvos = JSON.parse(localStorage.getItem('comentarios')) || [];
        
        comentariosSalvos.forEach(comentario => {
          const divComentario = document.createElement("div");
          divComentario.className = comentario.autor === sessionStorage.getItem("NOME_USUARIO") ? "comentario comentario-usuario" : "comentario";
          divComentario.innerHTML = `
            <b>${comentario.autor}</b> (${comentario.data}): <i>${comentario.emocao}</i>
            <p>${comentario.texto}</p>
          `;
          divComentarios.appendChild(divComentario);
        });
      }

      // Carregar os comentários ao carregar a página
      window.onload = function() {
        renderizarComentarios();
      };
    </script>
  </body>
</html>
